<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  body { font-family: sans-serif; padding: 20px; background:#222; color:#fff; }
  h1,h2 { margin-bottom:10px; }
  input, select, button { margin: 5px 0; padding: 8px; width: 300px; }
  .app { margin-bottom: 15px; background:#333; padding:10px; border-radius:5px; display:flex; align-items:center; justify-content: space-between; }
  .app img { max-width:50px; max-height:50px; margin-right:10px; }
  .app-details { display:flex; align-items:center; }
  .app-buttons button { margin-left: 5px; }

  /* Modal Styles */
  .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
  .modal-content { background-color: #333; margin: 10% auto; padding: 20px; border-radius: 10px; width: 350px; color: #fff; text-align: center; }
  .modal-content img { max-width: 100px; max-height: 100px; margin-bottom: 10px; }
  .close { float: right; font-size: 20px; cursor: pointer; color: #fff; }
  label { display:block; margin-top:5px; text-align:left; }
</style>
</head>
<body>

<h1>Admin Dashboard</h1>
<div style="margin-bottom: 10px;">
  <button onclick="logout()">Logout</button>
  <a href="index.html" style="margin-left: 10px; padding: 8px 12px; background:#555; color:#fff; text-decoration:none; border-radius:5px;">Home</a>
</div>

<h2>Add New App</h2>
<div>
  <input type="text" id="appName" placeholder="App Name"><br>
  <label>Image Name (from img folder):</label>
  <input type="text" id="appImage" placeholder="example.png"><br>
  <label>File Name (from files folder):</label>
  <input type="text" id="appFile" placeholder="example.exe"><br>
  <label>
    <input type="checkbox" id="appAnnouncement">
    Coming Soon(disable download)
  </label>
  <button onclick="addApp()">Add App</button>
</div>

<h2>Existing Apps</h2>
<div id="appList"></div>

<!-- Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Edit App</h3>
    <img id="modalImage" src="" alt="App Image"><br>
    <input type="text" id="modalName" placeholder="App Name"><br>
    <label>Image Name (img folder):</label>
    <input type="text" id="modalNewImage" placeholder="example.png"><br>
    <label>File Name (files folder):</label>
    <input type="text" id="modalNewFile" placeholder="example.exe"><br>
    <label>
      <input type="checkbox" id="modalAnnouncement">
      Coming Soon(disable download)
    </label><br><br>
    <button onclick="saveChanges()">Save Changes</button>
  </div>
</div>

<script>
  // Auto logout on refresh/close
  window.onbeforeunload = function(){ localStorage.removeItem('admin'); };

  if(localStorage.getItem('admin') !== 'true'){
    window.location.href = 'myadmin-portal.html';
  }

  let apps = JSON.parse(localStorage.getItem('apps') || '[]');
  let currentEditIndex = null;

  function renderApps(){
    const container = document.getElementById('appList');
    container.innerHTML = '';
    apps.forEach((app, index) => {
      container.innerHTML += `
        <div class="app">
          <div class="app-details">
            <img src="img/${app.image}" alt="${app.name}" />
            <div>
              <b>${app.name}</b><br>
              <small>File: ${app.file}</small><br>
              <small>Coming Soon: ${app.announcement ? 'Yes' : 'No'}</small>
            </div>
          </div>
          <div class="app-buttons">
            <button onclick="openModal(${index})">Edit</button>
            <button onclick="deleteApp(${index})">Delete</button>
          </div>
        </div>
      `;
    });
  }

  function addApp(){
    const name = document.getElementById('appName').value.trim();
    const image = document.getElementById('appImage').value.trim();
    const file = document.getElementById('appFile').value.trim();
    const announcement = document.getElementById('appAnnouncement').checked;

    if(!name || !image || !file){
      alert("Please fill all fields!");
      return;
    }

    apps.push({ name, image, file, announcement });
    localStorage.setItem('apps', JSON.stringify(apps));
    renderApps();

    document.getElementById('appName').value = '';
    document.getElementById('appImage').value = '';
    document.getElementById('appFile').value = '';
    document.getElementById('appAnnouncement').checked = false;
  }

  function deleteApp(index){
    if(confirm("Are you sure you want to delete this app?")){
      apps.splice(index,1);
      localStorage.setItem('apps', JSON.stringify(apps));
      renderApps();
    }
  }

  // Modal functions
  const modal = document.getElementById('editModal');
  function openModal(index){
    currentEditIndex = index;
    const app = apps[index];
    document.getElementById('modalImage').src = "img/" + app.image;
    document.getElementById('modalName').value = app.name;
    document.getElementById('modalNewImage').value = app.image;
    document.getElementById('modalNewFile').value = app.file;
    document.getElementById('modalAnnouncement').checked = !!app.announcement;
    modal.style.display = 'block';
  }
  function closeModal(){ modal.style.display = 'none'; }

  function saveChanges(){
    const name = document.getElementById('modalName').value.trim();
    const image = document.getElementById('modalNewImage').value.trim();
    const file = document.getElementById('modalNewFile').value.trim();
    const announcement = document.getElementById('modalAnnouncement').checked;

    if(!name || !image || !file){
      alert("Please fill all fields!");
      return;
    }

    apps[currentEditIndex] = { name, image, file, announcement };
    localStorage.setItem('apps', JSON.stringify(apps));
    renderApps();
    closeModal();
  }

  function logout(){
    localStorage.removeItem('admin');
    window.location.href = "myadmin-portal.html";
  }

  renderApps();
</script>

</body>
</html>
